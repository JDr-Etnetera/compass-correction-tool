<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="W+Fc5Q:|P%lS-`;ephTT">tmp</variable><variable id="mVgoiDBl25eOy0B53+4B">delta</variable><variable id="7okY(jI`N7dCtCi}8:Yw">compass</variable></variables><block type="function_call_output" id="_(`u$p$bdQQbJ;zH!e~;" disabled="true" x="934" y="-111"><mutation name="getDelta_ComHis" functionid="i-kb}A_4+mv)P);KGZyK"/></block><block type="device_forever" id="X|a}2l54O`5GrnOegIf$" x="496" y="-45"/><block type="pxt-on-start" id="9cIcOq6Sy7eGSQK3X;]U" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="m-dkbJ__hn1K^COu8d;4" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let tmp: number;" numlines="1" declaredvars="tmp"></mutation><next><block type="variables_set" id="-OU{1p6vN,2-nsGlpBAa"><field name="VAR" id="W+Fc5Q:|P%lS-`;ephTT">tmp</field><value name="VALUE"><shadow type="math_number" id="5Q(`^L?^MGmj+s=|eS[;"><field name="NUM">-100</field></shadow></value><next><block type="typescript_statement" id="3wm3Dx+g#@p4_w{Fb5j|" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let compass: number;" numlines="1" declaredvars="compass"></mutation><next><block type="variables_set" id="_)?]%*FoLzD+5rIPi15?"><field name="VAR" id="7okY(jI`N7dCtCi}8:Yw">compass</field><value name="VALUE"><shadow type="math_number" id=")zRooKd=E_ydKIF%JIZ]"><field name="NUM">0</field></shadow></value><next><block type="typescript_statement" id="wWq9iJOKwCzQyKKn$M7j" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let delta: number;" numlines="1" declaredvars="delta"></mutation><next><block type="variables_set" id="QCmMYhW$Uc9!J0qF=P|m"><field name="VAR" id="mVgoiDBl25eOy0B53+4B">delta</field><value name="VALUE"><shadow type="math_number" id="ixiY7vY8~)A#=]MGT9!f"><field name="NUM">0</field></shadow></value><next><block type="typescript_statement" id="XWu=I=#dV#+g8zhZ{Hn8" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class CorrectionMap {" line1="    private maxKeys: number;" line2="    private maxInRow: number;" line3="    private map: number[][]; // angle index - values count" line4="    constructor(keys: number, inRow: number) {" line5="        this.maxKeys = keys;" line6="        this.maxInRow = inRow;        " line7="        this.map = [];" line8="    }" line9="    addAngle(angle: number) {" line10="        this.map[angle][0] = this.map[angle][0] + 1;" line11="    }" line12="    removeAngleHistory(angle: number) {" line13="        this.map[angle][0] = 0;" line14="    }" line15="    reset() {" line16="        this.map = [];" line17="    }" line18="    getAll() {" line19="        return this.map;" line20="    }" line21="    /*" line22="    for (var key in myArray) {" line23="      console.log(&quot;key &quot; + key + &quot; has value &quot; + myArray[key]);" line24="    }" line25="    */ " line26="}" numlines="27"></mutation><next><block type="typescript_statement" id="H/66+Y,{5}9wZ.-%$Ruy" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class LimitedFront {" line1="    private maxEntries: number;" line2="    private front: number[];" line3="    private correction: CorrectionMap;" line4="    constructor(max: number) {" line5="        this.front = [];" line6="        this.maxEntries = max;" line7="        this.correction = new CorrectionMap(10, 20);" line8="    }" line9="    append(value: number) {" line10="        if (this.front.length &gt;= this.maxEntries) {" line11="            this.front.splice(0, this.front.length - this.maxEntries +1);" line12="        }" line13="        this.front.push(value);" line14="        this.correction.addAngle(value);" line15="    }" line16="    getDelta(dec: number) {" line17="        if (this.getLength() &lt; 1) return -100;" line18="        let sum = 0;" line19="        this.front.forEach(function (e) {" line20="            sum += e;" line21="        });" line22="        return Math.round( (sum * Math.pow(10, dec)) / this.getLength() ) / Math.pow(10, dec);" line23="    }" line24="    getFromRow() {" line25="        if (this.front.length &gt; 0) {" line26="            return this.front.slice(0,1);" line27="        }" line28="        return -100;" line29="    }" line30="    getLength() {" line31="        return this.front.length;" line32="    }" line33="    reset() {" line34="        this.front = [];" line35="        this.correction.reset();" line36="    }" line37="    getHistory() {" line38="        return this.front" line39="    }" line40="    getCorrection() {" line41="        return this.correction.getAll();" line42="    }" line43="}" numlines="44"></mutation><next><block type="typescript_statement" id="{;xfLnid`9Wgd:7B}g/z" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let cHistory = new LimitedFront(100);" numlines="1" declaredvars="cHistory"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="every_interval" id="vCG,jI9.xCHl0WtBVHCN" x="924" y="-6"><value name="interval"><shadow type="longTimePicker" id="93%#2_!;a@?DP:+uwR.T"><field name="ms">500</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="@rBLtQw!HBF4k#?!=zWR"><field name="VAR" id="W+Fc5Q:|P%lS-`;ephTT">tmp</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="function_call_output" id="O5sr]fYyOU:n%GYrfvhw"><mutation name="getDelta_ComHis" functionid="i-kb}A_4+mv)P);KGZyK"/></block></value><next><block type="controls_if" id="?s/saYp1?W=/8NGD#$3R"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="bk,X;.d(Ve.X,|[HZFNe"><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id=".N1y)BGLx9cGT$.l#8Hk"><field name="VAR" id="W+Fc5Q:|P%lS-`;ephTT">tmp</field></block></value><value name="B"><shadow type="math_number" id=":uA_Vl`CU$/Kmpy2j9pO"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="serial_writestring" id="XKSy{5yqOB#p4F78B,rc"><value name="text"><block type="text_join" id="UwLeQ}%Ir*t+T+^C^Bp7"><mutation items="2"/><value name="ADD0"><shadow type="text" id="73wEyupw0@HqpiQED.Tw"><field name="TEXT"> ERR </field></shadow></value><value name="ADD1"><shadow type="text"><field name="TEXT"/></shadow><block type="typescript_expression" id="WLw?6a!!t9`^Y[.v)Ta0" editable="false"><field name="EXPRESSION">'\n'</field></block></value></block></value></block></statement><statement name="ELSE"><block type="variables_set" id="[O!o1As^{TG3:4UZ@EbK"><field name="VAR" id="mVgoiDBl25eOy0B53+4B">delta</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="ED$VGB[)Nc(03QO-;n+;"><field name="VAR" id="W+Fc5Q:|P%lS-`;ephTT">tmp</field></block></value><next><block type="serial_writevalue" id="@7kCi_$O,fm^Ofb)C[I$"><value name="name"><shadow type="text" id="3YgPkm5zEOHKOpJf$XKh"><field name="TEXT">D</field></shadow></value><value name="value"><block type="variables_get" id="h=LB8{vM3H9u$_dx`V^@"><field name="VAR" id="mVgoiDBl25eOy0B53+4B">delta</field></block></value><next><block type="serial_writevalue" id="/a,RAj:=Hhz]tQp]foOK"><value name="name"><shadow type="text" id="8Vkq5`G#3=(jZk-.%46I"><field name="TEXT">L</field></shadow></value><value name="value"><block type="typescript_expression" id="+m4ljmhfVGW@4pH|5+gg" editable="false"><field name="EXPRESSION">cHistory.getLength()</field></block></value></block></next></block></next></block></statement></block></next></block></statement></block><block type="every_interval" id="Rns](n.}`pFrMp+bU7b4" x="1511" y="-17"><value name="interval"><shadow type="longTimePicker" id="gt$mM{MT7(Zmt`SsW!/%"><field name="ms">25</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="E9cef5YRjtIm,dM#-Osh"><field name="VAR" id="7okY(jI`N7dCtCi}8:Yw">compass</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_heading" id="!Sb]JT82nj7xszwZ6h+w"/></value><next><block type="function_call" id="_pB2mV|jL4}okwup2}0C"><mutation name="append_ComHis" functionid="442bq.~8jctaKe[a[NFY"><arg name="value" id="89q6ayhdpri0n63gfa6ow" type="number"/></mutation><value name="89q6ayhdpri0n63gfa6ow"><shadow type="math_number" id="PuF{poBBsO.x[i-_i~$F"><field name="NUM">1</field></shadow><block type="variables_get" id="wq.W7-lt0q`%LtIzsW0T"><field name="VAR" id="7okY(jI`N7dCtCi}8:Yw">compass</field></block></value><next><block type="serial_writevalue" id="/QQ=1q:cX/z)ccxY4v)J"><value name="name"><shadow type="text" id="e^0^FMsefKW`zB4.^Hqb"><field name="TEXT">c</field></shadow></value><value name="value"><block type="variables_get" id="8n8Q]RoDDaPd^P1^uJ6j"><field name="VAR" id="7okY(jI`N7dCtCi}8:Yw">compass</field></block></value></block></next></block></next></block></statement></block><block type="every_interval" id="w=vT?Slt45_OBOns_BwN" x="234" y="115"><value name="interval"><shadow type="longTimePicker" id="*@:F#QWe;C;h=}73^ivI"><field name="ms">1000</field></shadow></value></block><block type="function_definition" id="p|.[,zTc2*tmIGI-6v}8" x="2582" y="45"><mutation name="reset_ComHis" functionid="6WCYFb[1Zt;PB(dJvwmv"/><field name="function_name">reset_ComHis</field><statement name="STACK"><block type="typescript_statement" id="FavW*=p80z{g7_0G)?qS" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="cHistory.reset();" numlines="1"></mutation></block></statement></block><block type="serial_writenumbers" id="#y0fa1uMrhf7MlXqA!5Z" disabled="true" x="237" y="241"><value name="values"><block type="typescript_expression" id="aL:TZj7^szKnvUNWkn@a" disabled="true" editable="false"><field name="EXPRESSION">cHistory.getHistory()</field></block></value></block><block type="function_definition" id="IJv9i3nld}ll9_Uw[sXM" x="2576" y="215"><mutation name="getDelta_ComHis" functionid="i-kb}A_4+mv)P);KGZyK"/><field name="function_name">getDelta_ComHis</field><statement name="STACK"><block type="function_return" id="tSNvw/ApOPu5.P{bcc_N"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="typescript_expression" id="1FgpqI`A1dlX##w_/03G" editable="false"><field name="EXPRESSION">cHistory.getDelta(1)</field></block></value></block></statement></block><block type="function_definition" id="lZHZ+Z6zsCVSd(w-=i1b" x="2576" y="396"><mutation name="append_ComHis" functionid="442bq.~8jctaKe[a[NFY"><arg name="value" id="89q6ayhdpri0n63gfa6ow" type="number"/></mutation><field name="function_name">append_ComHis</field><value name="89q6ayhdpri0n63gfa6ow"><shadow type="argument_reporter_number" id="k)nyNv@)%6$n/LFnL7j;"><field name="VALUE">value</field></shadow></value><statement name="STACK"><block type="typescript_statement" id="Ft0X`dn/yEz^=[!5YCZ8" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="cHistory.append(value);" numlines="1"></mutation></block></statement></block><block type="device_button_event" id="GA:yc[I]xp5#Z.-={N9q" x="2578" y="576"><field name="NAME">Button.B</field><statement name="HANDLER"><block type="function_call" id="x!;qIFx@q9OiodT/Q(.%"><mutation name="reset_ComHis" functionid="6WCYFb[1Zt;PB(dJvwmv"/></block></statement></block></xml>