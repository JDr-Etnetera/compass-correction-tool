<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="JoWc!EFu%L?2^rI@blmQ">tmp</variable><variable id="g)6+;h=6;X2h#__#q[Lj">delta</variable><variable id="ELmi3Lb2x{adaI^mUyCP">compass</variable></variables><block type="function_call_output" id=",3EA+1CT%O1men-_ZrYf" disabled="true" x="914" y="-131"><mutation name="getDelta_ComHis" functionid="()_/j~r7qqSF(4T3D3:$"/></block><block type="device_forever" id="?`JZKul?%[bJ|u+Gx@2|" x="476" y="-65"/><block type="pxt-on-start" id="]XWET[%C(y*/E^%.S4b$" x="0" y="0"><statement name="HANDLER"><block type="typescript_statement" id="]tQSkX%thR+1tvhAK+QG" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let tmp: number;" numlines="1" declaredvars="tmp"></mutation><next><block type="variables_set" id="yhMOL3sU897o#Q+Wmkpu"><field name="VAR" id="JoWc!EFu%L?2^rI@blmQ">tmp</field><value name="VALUE"><shadow type="math_number" id="uX*Bnd+ygfSt3W8VRsG%"><field name="NUM">-100</field></shadow></value><next><block type="typescript_statement" id="%Ey{p06dI~tPGdQ;/gDh" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let compass: number;" numlines="1" declaredvars="compass"></mutation><next><block type="variables_set" id="rz[dvv!T@DpFX.yZNa5]"><field name="VAR" id="ELmi3Lb2x{adaI^mUyCP">compass</field><value name="VALUE"><shadow type="math_number" id="r!81bkn6=z6_KOWbvUk5"><field name="NUM">0</field></shadow></value><next><block type="typescript_statement" id="MT%AJV_^8.%=E}:rSf$K" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let delta: number;" numlines="1" declaredvars="delta"></mutation><next><block type="variables_set" id="rtt%M0`31C]f:C}@/4{."><field name="VAR" id="g)6+;h=6;X2h#__#q[Lj">delta</field><value name="VALUE"><shadow type="math_number" id="e,v%$6#4{/*bLy4$7:@i"><field name="NUM">0</field></shadow></value><next><block type="typescript_statement" id="nfUFr*|NV;BMoF`4Kheq" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class CorrectionMap {" line1="    private maxKeys: number;" line2="    private maxInRow: number;" line3="    private map: number[][]; // angle index - values count" line4="    private angleList: number[];" line5="    constructor(keys: number, inRow: number) {" line6="        this.maxKeys = keys;" line7="        this.maxInRow = inRow;        " line8="        this.reset();" line9="    }" line10="    private isNewAngle(angle: number) {" line11="        return ! (this.angleList.indexOf(angle) &gt;= 0)" line12="    }" line13="    addAngle(angle: number) {" line14="        if (this.isNewAngle(angle)) {" line15="            this.map[angle] = [];" line16="            this.map[angle][0] = 0;" line17="            this.angleList.push(angle);" line18="        }" line19="        this.map[angle][0] = this.map[angle][0] + 1;" line20="    }" line21="    removeAngleHistory(angle: number) {" line22="        this.map[angle][0] = 0;" line23="    }" line24="    reset() {" line25="        this.map = [];" line26="        this.angleList = [];" line27="    }" line28="    getAll() {" line29="        return this.map;" line30="    }" line31="    /*" line32="    for (var key in myArray) {" line33="      console.log(&quot;key &quot; + key + &quot; has value &quot; + myArray[key]);" line34="    }" line35="    */ " line36="}" numlines="37"></mutation><next><block type="typescript_statement" id="f`DPXOdWHkVVsX1]fa-U" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="class LimitedFront {" line1="    private maxEntries: number;" line2="    private front: number[];" line3="    private correction: CorrectionMap;" line4="    constructor(max: number) {" line5="        this.front = [];" line6="        this.maxEntries = max;" line7="        this.correction = new CorrectionMap(10, 20);" line8="    }" line9="    append(value: number) {" line10="        if (this.front.length &gt;= this.maxEntries) {" line11="            this.front.splice(0, this.front.length - this.maxEntries +1);" line12="        }" line13="        this.front.push(value);" line14="        this.correction.addAngle(value);" line15="    }" line16="    getDelta(dec: number) {" line17="        if (this.getLength() &lt; 1) return -100;" line18="        let sum = 0;" line19="        this.front.forEach(function (e) {" line20="            sum += e;" line21="        });" line22="        return Math.round( (sum * Math.pow(10, dec)) / this.getLength() ) / Math.pow(10, dec);" line23="    }" line24="    getFromRow() {" line25="        if (this.front.length &gt; 0) {" line26="            return this.front.slice(0,1);" line27="        }" line28="        return -100;" line29="    }" line30="    getLength() {" line31="        return this.front.length;" line32="    }" line33="    reset() {" line34="        this.front = [];" line35="        this.correction.reset();" line36="    }" line37="    getHistory() {" line38="        return this.front" line39="    }" line40="    getCorrection() {" line41="        return this.correction.getAll();" line42="    }" line43="}" numlines="44"></mutation><next><block type="typescript_statement" id="e8L7gEzZ/#;VT!fhdfAs" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="let cHistory = new LimitedFront(100);" numlines="1" declaredvars="cHistory"></mutation></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="every_interval" id=".dF?G|S_BsyGG6PmkYT(" x="904" y="-26"><value name="interval"><shadow type="longTimePicker" id="$K^Ekh:sS*]@MY}8bWTX"><field name="ms">1000</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="Pq(lpNh6uwRN~C[GIg7V"><field name="VAR" id="JoWc!EFu%L?2^rI@blmQ">tmp</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="function_call_output" id="~xd`ufL.PuU46Bzoh~]/"><mutation name="getDelta_ComHis" functionid="()_/j~r7qqSF(4T3D3:$"/></block></value><next><block type="controls_if" id="W2x||7]1FQ24.Uw[:V-l"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="ysYfhq!u{#!2wrKJ-C#8"><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="HjcI1A?5Vu3:~D*KG%%P"><field name="VAR" id="JoWc!EFu%L?2^rI@blmQ">tmp</field></block></value><value name="B"><shadow type="math_number" id="Q-EPWf[aV}XhgWA)}2$W"><field name="NUM">0</field></shadow></value></block></value><statement name="DO0"><block type="serial_writestring" id="M`Ao=0sm[{tEDsUWxg8="><value name="text"><block type="text_join" id="m9^)%,p}giP|+{.0T~HO"><mutation items="2"/><value name="ADD0"><shadow type="text" id="}#5q@[py}hC/?@c)g_wW"><field name="TEXT"> ERR </field></shadow></value><value name="ADD1"><shadow type="text"><field name="TEXT"/></shadow><block type="typescript_expression" id="QdI^.Ohk2=!.]=YCELcx" editable="false"><field name="EXPRESSION">'\n'</field></block></value></block></value></block></statement><statement name="ELSE"><block type="variables_set" id="Z7S?R{{l}?OGDwT6-.RR"><field name="VAR" id="g)6+;h=6;X2h#__#q[Lj">delta</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="ZlECrbfM=iKF#iMzVrut"><field name="VAR" id="JoWc!EFu%L?2^rI@blmQ">tmp</field></block></value><next><block type="serial_writevalue" id="$iU+0[V9Ow[LQuijJ2Pt"><value name="name"><shadow type="text" id="e=_yL`l~#(P/k6c8AAGf"><field name="TEXT">D</field></shadow></value><value name="value"><block type="variables_get" id="U`)clT;EGF(`B{ID9CQs"><field name="VAR" id="g)6+;h=6;X2h#__#q[Lj">delta</field></block></value><next><block type="serial_writevalue" id=":V4?n:@=m7nx2Ej:[lxk"><value name="name"><shadow type="text" id="F.x-GQsrcbvqD1x#mMup"><field name="TEXT">L</field></shadow></value><value name="value"><block type="typescript_expression" id="gdw2)r9LPn+$%YwURhv/" editable="false"><field name="EXPRESSION">cHistory.getLength()</field></block></value></block></next></block></next></block></statement></block></next></block></statement></block><block type="every_interval" id="y2h?#cRB.;b.OA/zC[LU" x="1491" y="-37"><value name="interval"><shadow type="longTimePicker" id="Nd%sm#jQF%Wh!T9f52h2"><field name="ms">1000</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="6n`A64yM5t7{G57X6GI4"><field name="VAR" id="ELmi3Lb2x{adaI^mUyCP">compass</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="device_heading" id="p`_G{)RYXIc$ztY6HPD/"/></value><next><block type="function_call" id="+)U#4P:JYs9:e7u-,W|$"><mutation name="append_ComHis" functionid="##[/!+`zjgKrqySRkF+u"><arg name="value" id="oqqxit8v6andwhppp591a" type="number"/></mutation><value name="oqqxit8v6andwhppp591a"><shadow type="math_number" id="D94924I`Q0l[)eR+l5]6"><field name="NUM">1</field></shadow><block type="variables_get" id="Q?]#._VqA$F(_c9QU$Hs"><field name="VAR" id="ELmi3Lb2x{adaI^mUyCP">compass</field></block></value><next><block type="serial_writevalue" id="og1s!;p.?@:?-ZcJK6ZT"><value name="name"><shadow type="text" id="f`LX;JNQ|S~2Jk2zV~85"><field name="TEXT">c</field></shadow></value><value name="value"><block type="variables_get" id="L,1+0o]-YIvYkY;.*gG("><field name="VAR" id="ELmi3Lb2x{adaI^mUyCP">compass</field></block></value></block></next></block></next></block></statement></block><block type="function_definition" id="46@eK:2@K%]x)*DEby3d" x="2562" y="25"><mutation name="reset_ComHis" functionid="fWEhf?QqZNG3~wjwSHS:"/><field name="function_name">reset_ComHis</field><statement name="STACK"><block type="typescript_statement" id="v4g3_.1J29vjk*XKN9mC" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="cHistory.reset();" numlines="1"></mutation></block></statement></block><block type="function_definition" id="Y{5#)H+quv$zVm7fyMgy" x="2556" y="195"><mutation name="getDelta_ComHis" functionid="()_/j~r7qqSF(4T3D3:$"/><field name="function_name">getDelta_ComHis</field><statement name="STACK"><block type="function_return" id="6__WKVvA2@)UY]Slq*uc"><mutation xmlns="http://www.w3.org/1999/xhtml" no_return_value="false"></mutation><value name="RETURN_VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="typescript_expression" id="eTP|.)oL0OkyGC=qQVbo" editable="false"><field name="EXPRESSION">cHistory.getDelta(1)</field></block></value></block></statement></block><block type="function_definition" id="4loGG5PB69JMe3iO+1DN" x="2556" y="376"><mutation name="append_ComHis" functionid="##[/!+`zjgKrqySRkF+u"><arg name="value" id="oqqxit8v6andwhppp591a" type="number"/></mutation><field name="function_name">append_ComHis</field><value name="oqqxit8v6andwhppp591a"><shadow type="argument_reporter_number" id="nWYnx,ua/j~zG|jFW+kV"><field name="VALUE">value</field></shadow></value><statement name="STACK"><block type="typescript_statement" id="78w=gdrRkcH-XS*vVf]=" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="cHistory.append(value);" numlines="1"></mutation></block></statement></block><block type="every_interval" id="H3p3Wq#)*2,:+6XE$T.T" x="900" y="467"><value name="interval"><shadow type="longTimePicker" id=".8G17ian=8r^.[[|hI;u"><field name="ms">1000</field></shadow></value><statement name="HANDLER"><block type="typescript_statement" id="X}OfmmG2HMJ)tUStnb65" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="console.log(cHistory.getHistory())" numlines="1"></mutation><next><block type="typescript_statement" id="%|0.$Bn+Fsi8|Qm*r2b0" editable="false"><mutation xmlns="http://www.w3.org/1999/xhtml" line0="console.log(cHistory.getCorrection());" numlines="1"></mutation></block></next></block></statement></block><block type="device_button_event" id="3^$MCToug_^TB(?t!][9" x="2558" y="556"><field name="NAME">Button.B</field><statement name="HANDLER"><block type="function_call" id="{:UKHJ#c(=z.u,Xgh~SG"><mutation name="reset_ComHis" functionid="fWEhf?QqZNG3~wjwSHS:"/></block></statement></block></xml>